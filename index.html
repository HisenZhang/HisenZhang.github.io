<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/h-favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/h-favicon-16x16.png"><link rel="mask-icon" href="/images/h-logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"hisenz.com",root:"/",scheme:"Pisces",version:"8.0.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!1,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:"disqus",storage:!0,lazyload:!0,nav:null,activeClass:"disqus"},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,i18n:{placeholder:"Searching...",empty:"We didn't find any results for the search: ${query}",hits_time:"${hits} results found in ${time} ms",hits:"${hits} results found"}}</script><meta name="description" content="海森的博客 - 技术, 料理 &amp; 爵士乐"><meta property="og:type" content="website"><meta property="og:title" content="海森的博客"><meta property="og:url" content="https://hisenz.com/index.html"><meta property="og:site_name" content="海森的博客"><meta property="og:description" content="海森的博客 - 技术, 料理 &amp; 爵士乐"><meta property="og:locale" content="en_US"><meta property="article:author" content="Hisen Zhang"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://hisenz.com/"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"en"}</script><title>海森的博客</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript><link rel="alternate" href="/rss2.xml" title="海森的博客" type="application/rss+xml">
</head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">海森的博客</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Hacking, Cooking & Thinking</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-tech"><a href="/categories/Technology" rel="section"><i class="fa fa-desktop fa-fw"></i>Tech</a></li><li class="menu-item menu-item-food"><a href="/categories/Food" rel="section"><i class="fa fa-utensils fa-fw"></i>Food</a></li><li class="menu-item menu-item-music"><a href="/categories/Music" rel="section"><i class="fa fa-music fa-fw"></i>Music</a></li><li class="menu-item menu-item-spark"><a href="/categories/Spark" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Spark</a></li><li class="menu-item menu-item-lecture"><a href="/categories/Lecture" rel="section"><i class="fa fa-graduation-cap fa-fw"></i>Lecture</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li></ul></nav></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><section class="post-toc-wrap sidebar-panel"></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Hisen Zhang" src="/images/h-logo.svg"><p class="site-author-name" itemprop="name">Hisen Zhang</p><div class="site-description" itemprop="description">海森的博客 - 技术, 料理 & 爵士乐</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">62</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">5</span> <span class="site-state-item-name">categories</span></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">43</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/HisenZhang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;HisenZhang" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:hisenzhang01@gmail.com" title="E-Mail → mailto:hisenzhang01@gmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Hisen & Friends</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://maomihz.com/" title="https:&#x2F;&#x2F;maomihz.com" rel="noopener" target="_blank">MaomiHZ</a></li><li class="links-of-blogroll-item"><a href="https://hivechat.org/" title="https:&#x2F;&#x2F;hivechat.org" rel="noopener" target="_blank">Echo's Hive</a></li><li class="links-of-blogroll-item"><a href="https://sites.google.com/view/yuxincai/home" title="https:&#x2F;&#x2F;sites.google.com&#x2F;view&#x2F;yuxincai&#x2F;home" rel="noopener" target="_blank">Yuxin</a></li></ul></div></section></div></aside><div class="sidebar-dimmer"></div></header><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://hisenz.com/post/opsys-memo/home/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/h-logo.svg"><meta itemprop="name" content="Hisen Zhang"><meta itemprop="description" content="海森的博客 - 技术, 料理 & 爵士乐"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="海森的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/post/opsys-memo/home/" class="post-title-link" itemprop="url">Hisen's Memo on OPSYS</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2023-05-30 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-30T00:00:00+08:00">2023-05-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-05-11 12:50:40" itemprop="dateModified" datetime="2023-05-11T12:50:40+08:00">2023-05-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Lecture/" itemprop="url" rel="index"><span itemprop="name">Lecture</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus: </span><a title="disqus" href="/post/opsys-memo/home/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/opsys-memo/home/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>A collection of memos on CSCI 4210 Operating System.</p><ol><li><a href="/post/opsys-memo/memory-debugging/" title="The Guide to Memory Debugging">The Guide to Memory Debugging</a></li><li><a href="/post/opsys-memo/unix-c/" title="The Philosophy of UNIX and C Programming Language">The Philosophy of UNIX and C Programming Language</a></li><li><a href="/post/opsys-memo/libc/" title="About libc - The Standard C library">About libc - The Standard C library</a></li><li><a href="/post/opsys-memo/syscall/" title="System Calls - What’s Underneath the Hood">System Calls - What’s Underneath the Hood</a></li></ol></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://hisenz.com/post/opsys-memo/program-structuring/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/h-logo.svg"><meta itemprop="name" content="Hisen Zhang"><meta itemprop="description" content="海森的博客 - 技术, 料理 & 爵士乐"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="海森的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/post/opsys-memo/program-structuring/" class="post-title-link" itemprop="url">Structure Your Program Neatly</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2023-05-12 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-12T00:00:00+08:00">2023-05-12</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-05-11 12:46:23" itemprop="dateModified" datetime="2023-05-11T12:46:23+08:00">2023-05-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Lecture/" itemprop="url" rel="index"><span itemprop="name">Lecture</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus: </span><a title="disqus" href="/post/opsys-memo/program-structuring/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/opsys-memo/program-structuring/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://hisenz.com/post/opsys-memo/syscall/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/h-logo.svg"><meta itemprop="name" content="Hisen Zhang"><meta itemprop="description" content="海森的博客 - 技术, 料理 & 爵士乐"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="海森的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/post/opsys-memo/syscall/" class="post-title-link" itemprop="url">System Calls - What’s Underneath the Hood</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2023-05-11 00:00:00 / Modified: 12:46:28" itemprop="dateCreated datePublished" datetime="2023-05-11T00:00:00+08:00">2023-05-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Lecture/" itemprop="url" rel="index"><span itemprop="name">Lecture</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus: </span><a title="disqus" href="/post/opsys-memo/syscall/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/opsys-memo/syscall/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>In previous memos, I briefly mentioned that <code>read()</code> and <code>write()</code> functions in libc are wrappers of system call <code>read</code> and <code>write</code>. Note that they are very different animals not to be confused. System calls, also known as syscalls, are the interface between user-level applications and the operating system kernel. They enable applications to request services and resources from the operating system. By invoking specific system calls, applications can perform operations such as file I/O, process management, memory allocation, and hardware interaction.</p><p>System calls facilitate privileged operations by transferring control from user mode to kernel mode, where the operating system handles the requested tasks. Once the system call is completed, control returns to user mode, allowing the application to continue its execution.</p><h2 id="Linux-System-Call-Table"><a href="#Linux-System-Call-Table" class="headerlink" title="Linux System Call Table"></a>Linux System Call Table</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://chromium.googlesource.com/chromiumos/docs/+/master/constants/syscalls.md#x86_64-64_bit">Reference</a></p><p>System calls are vital for the functioning of an operating system as they provide a standardized mechanism for applications to interact with the underlying system, offering a predefined set of functions and parameters for various operations. Below is an excerpt from the Linux system call table:</p><table><thead><tr><th>NR</th><th>Syscall Name</th></tr></thead><tbody><tr><td>0</td><td>read</td></tr><tr><td>1</td><td>write</td></tr><tr><td>2</td><td>open</td></tr><tr><td>3</td><td>close</td></tr><tr><td>4</td><td>stat</td></tr><tr><td>7</td><td>poll</td></tr><tr><td>8</td><td>lseek</td></tr><tr><td>9</td><td>mmap</td></tr><tr><td>12</td><td>brk</td></tr><tr><td>16</td><td>ioctl</td></tr><tr><td>21</td><td>access</td></tr><tr><td>22</td><td>pipe</td></tr><tr><td>23</td><td>select</td></tr><tr><td>29</td><td>shmget</td></tr><tr><td>30</td><td>shmat</td></tr><tr><td>31</td><td>shmctl</td></tr><tr><td>32</td><td>dup</td></tr><tr><td>33</td><td>dup2</td></tr><tr><td>39</td><td>getpid</td></tr><tr><td>41</td><td>socket</td></tr><tr><td>42</td><td>connect</td></tr><tr><td>43</td><td>accept</td></tr><tr><td>44</td><td>sendto</td></tr><tr><td>45</td><td>recvfrom</td></tr><tr><td>49</td><td>bind</td></tr><tr><td>50</td><td>listen</td></tr><tr><td>56</td><td>clone</td></tr><tr><td>57</td><td>fork</td></tr><tr><td>59</td><td>execve</td></tr><tr><td>60</td><td>exit</td></tr><tr><td>61</td><td>wait4</td></tr><tr><td>62</td><td>kill</td></tr><tr><td>67</td><td>shmdt</td></tr></tbody></table><p>Do you see many familiar names? Yes, those libc functions are just wrapper for syscalls. Also note that <code>read</code> and <code>write</code> syscalls are on the very top of the table, as they are critical features since the earliest days of UNIX.</p><p>Technically it is possible to write programs only using system calls - you may try hard to print an integer in decimal with write syscall only - but libc serves as a collection of programmer-friendly snippets. When a libc function is called, it may internally invoke the corresponding system call to interact with the kernel and perform the required operation. The libc function acts as a wrapper around the system call, providing a higher-level and more convenient interface to the application developer. The libc function may perform additional error handling, data formatting, or provide additional functionality beyond the basic system call.</p><p>In summary, libc functions provide a higher-level interface for common programming tasks, while system calls offer direct access to kernel services and are used for privileged operations.</p><h2 id="Trace-Syscalls"><a href="#Trace-Syscalls" class="headerlink" title="Trace Syscalls"></a>Trace Syscalls</h2><p>If you wonder how system calls are used in program execution, use strace utility. strace is a command-line tool used on Unix-like systems to trace the system calls and signals made by a program. It allows you to see the interactions between a program and the operating system, which can be helpful for debugging, performance analysis, or understanding program behavior.</p><p>Let’s say we have a simple C program called hello.c that prints “Hello, world!” to the console:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello, world!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>To trace the system calls made by this program, we can compile it and run strace as follows:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -o hello hello.c</span><br><span class="line">strace ./hello</span><br></pre></td></tr></table></figure><p>The output of strace will show each system call made by the program and its corresponding result. Here’s a sample excerpt of the strace output for the hello program:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">execve(&quot;./hello&quot;, [&quot;./hello&quot;], 0x7ffdcdd64280 /*58 vars*/) = 0</span><br><span class="line">brk(NULL)                               = 0x5609415c4000</span><br><span class="line">…</span><br><span class="line">fstat(1, &#123;st_mode=S_IFCHR|0620, st_rdev=makedev(136, 0), ...&#125;) = 0</span><br><span class="line">brk(NULL)                               = 0x5609415c4000</span><br><span class="line">brk(0x5609415e5000)                     = 0x5609415e5000</span><br><span class="line">write(1, &quot;Hello, world!\n&quot;, 14Hello, world!</span><br><span class="line">)         = 14</span><br><span class="line">exit_group(0)                           = ?</span><br><span class="line">+++ exited with 0 +++</span><br></pre></td></tr></table></figure><p>In the above output, you can see various system calls such as execve, brk, arch_prctl, access, openat, write, and exit_group. Each line provides information about the system call, its arguments, and the return value. By analyzing the strace output, you can gain insights into how the program interacts with the operating system, diagnose issues, or understand the underlying system behavior during program execution.</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://hisenz.com/post/opsys-memo/libc/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/h-logo.svg"><meta itemprop="name" content="Hisen Zhang"><meta itemprop="description" content="海森的博客 - 技术, 料理 & 爵士乐"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="海森的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/post/opsys-memo/libc/" class="post-title-link" itemprop="url">About Libc - the Standard C Library</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2023-05-09 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-09T00:00:00+08:00">2023-05-09</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-05-11 12:48:02" itemprop="dateModified" datetime="2023-05-11T12:48:02+08:00">2023-05-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Lecture/" itemprop="url" rel="index"><span itemprop="name">Lecture</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus: </span><a title="disqus" href="/post/opsys-memo/libc/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/opsys-memo/libc/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>The C standard library, often referred to as libc, is a standard library for the C programming language. It provides a collection of functions and macros that are widely used in C programs. The functions mentioned in this memo series, such as printf, strcpy, and memmove, are part of the libc.</p><p>You may have seen header such “stdio.h”, “math.h” and “thread.h” so far in this class. The C library provides various modules and headers that contain functions for different purposes, including string manipulation, memory operations, file I/O, time handling, and more. These functions are typically implemented in C and are designed to be portable across different platforms and operating systems to provide convenient and efficient ways to perform those tasks, abstracting away the low-level details of memory management and data manipulation.</p><p>The most common libc in all major Linux distributions is glibc, The GNU C Library. The code is highly optimized thus not suitable for education purpose. Alternatively, Musl libc prioritizes simplicity, performance, and standards compliance while providing a minimal and highly compatible implementation of C library functions, therefore widely used in embedded systems.</p><p>Familiarize yourself with how libc works paves the way to a deeper understanding of operating systems and the language itself.</p><h2 id="Functions-Families"><a href="#Functions-Families" class="headerlink" title="Functions Families"></a>Functions Families</h2><p>You will often see functions with similar names in the C library. Functions with the “s-“ prefix generally deal with strings, while “mem-” is related to memory operations. Examples:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">strcpy</span><span class="params">(<span class="keyword">char</span> *dest, <span class="keyword">const</span> <span class="keyword">char</span> *src)</span></span>; <span class="comment">// copies one string to another</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strcmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s1, <span class="keyword">const</span> <span class="keyword">char</span> *s2)</span></span>; <span class="comment">// compares two strings</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">memcpy</span><span class="params">(<span class="keyword">void</span> *dest, <span class="keyword">const</span> <span class="keyword">void</span> *src, <span class="keyword">size_t</span> n)</span></span>;  <span class="comment">// copies a block of memory from one location to another</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">memcmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *s1, <span class="keyword">const</span> <span class="keyword">void</span> *s2, <span class="keyword">size_t</span> n)</span></span>; <span class="comment">// compares two blocks of memory</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">memmove</span><span class="params">(<span class="keyword">void</span> *dest, <span class="keyword">const</span> <span class="keyword">void</span> *src, <span class="keyword">size_t</span> n)</span></span>; <span class="comment">// similar to memcpy(), but allows overlapping memory block</span></span><br></pre></td></tr></table></figure><p>Note how similar their signatures are. The behavior of string and memory variants differ in several ways, primarily in handling the null byte: string functions will return upon hitting a ‘\0’. As an exercise, research the behavior of following functions in printf family:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">printf</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">restrict</span> format, ...)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fprintf</span><span class="params">(FILE *<span class="keyword">restrict</span> stream, <span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">restrict</span> format, ...)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">snprintf</span><span class="params">(<span class="keyword">char</span> *<span class="keyword">restrict</span> s, <span class="keyword">size_t</span> n, <span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">restrict</span> format, ...)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sprintf</span><span class="params">(<span class="keyword">char</span> *<span class="keyword">restrict</span> s, <span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">restrict</span> format, ...)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="Replacing-malloc"><a href="#Replacing-malloc" class="headerlink" title="Replacing malloc"></a>Replacing malloc</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.gnu.org/software/libc/manual/html_node/Replacing-malloc.html">Reference</a></p><p>The GNU C Library allows for the replacement of its default malloc implementation with an alternative allocator that follows the same interface. Some memory debuggers work this way by having a alternative malloc and free to track allocation history.</p><p>This replacement can be achieved for dynamically linked programs through ELF symbol interposition, using shared object dependencies or LD_PRELOAD. For statically linked programs, the custom malloc library needs to be linked before linking against libc.a, either explicitly or implicitly.</p><p>To ensure proper functioning of the GNU C Library, a minimum set of functions must be provided by the custom malloc implementation. These functions include malloc, free, calloc, and realloc. These specific malloc-related functions are essential for the proper operation of the GNU C Library.</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://hisenz.com/post/opsys-memo/unix-c/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/h-logo.svg"><meta itemprop="name" content="Hisen Zhang"><meta itemprop="description" content="海森的博客 - 技术, 料理 & 爵士乐"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="海森的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/post/opsys-memo/unix-c/" class="post-title-link" itemprop="url">The Philosophy of UNIX and C Programming Language</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2023-05-04 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-04T00:00:00+08:00">2023-05-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-05-11 12:46:33" itemprop="dateModified" datetime="2023-05-11T12:46:33+08:00">2023-05-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Lecture/" itemprop="url" rel="index"><span itemprop="name">Lecture</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus: </span><a title="disqus" href="/post/opsys-memo/unix-c/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/opsys-memo/unix-c/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>This memo overviews UNIX and C programming for CSCI 4210 Operating System from both high-level and low-level perspectives. <strong>In short: everything is an integer.</strong></p><h2 id="Alternative-Spelling-of-Integer"><a href="#Alternative-Spelling-of-Integer" class="headerlink" title="Alternative Spelling of Integer"></a>Alternative Spelling of Integer</h2><p>This class is about UNIX programming. We explore UNIX OS mechanisms and interact with them through APIs. One of the fundamental principles of the UNIX philosophy is to treat everything as a file, including hardware devices, directories, pipes, shared memory, and network sockets that we discussed in this class. The brilliant design allows read and write system calls to handle all IOs.</p><p>Now, let’s rethink some programming concepts you already know:</p><ul><li>Characters are small integers (0-127).</li><li>Pointers, aka addresses, are integers.</li><li>Functions are just pointers, so they are integers.</li><li>Structs are accessed through pointers - again, integers!<ul><li>Sometimes a pointer to a struct is called a handle because you can “grab” the struct with it.</li></ul></li></ul><p>All these concepts are just fancy ways to spell “integer”! Programming in C is to encode everything with integers and perform integer arithmetics. Apollo Guidance Computer sent people to the moon using only the magic power of integers. Files are no exception - you may have learned the concept of file descriptors already - again, integers. No surprise here, as C was initially designed for UNIX development in the 1970s.</p><p><strong>So, what’s magical with integers?</strong></p><p>Well, not really. An integer just maps to one state in a finite state machine, in this case, our computer. A computer has finite memory, thus can only represent finite number of states. Integer arithmetic models the transition between states. Any finite set may be used for this task, but with integers you can easily find the preceding and succeeding elements, as its arithmetic is intuitive.</p><h2 id="Read-and-Write"><a href="#Read-and-Write" class="headerlink" title="Read and Write"></a>Read and Write</h2><p>As mentioned above, many functions in the C library use the <code>read</code> and <code>write</code> function under the hood:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> count)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">write</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> count)</span></span>;</span><br></pre></td></tr></table></figure><p>As a low-level function, the read interface is straightforward: all you need is where to read from (file descriptor), where to read to (your buffer), and the number of bytes to read. This function makes a direct system call. So does the write function. You don’t care if the destination is on a floppy disk, an SSD, a pipe, or a network socket as long as it is a file-like object with a file descriptor (spell: i-n-t-e-g-e-r).</p><p>You may also find a set of file-related functions online:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">fread</span><span class="params">(<span class="keyword">void</span> *<span class="keyword">restrict</span> ptr, <span class="keyword">size_t</span> size, <span class="keyword">size_t</span> nmemb, FILE *<span class="keyword">restrict</span> stream)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">fwrite</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *<span class="keyword">restrict</span> ptr, <span class="keyword">size_t</span> size, <span class="keyword">size_t</span> nmemb, FILE *<span class="keyword">restrict</span> stream)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">fgets</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> size, FILE *stream)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fputs</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s, FILE *stream)</span></span>;</span><br></pre></td></tr></table></figure><p>These functions are part of the C library and provide buffered IO for better performance. When you call fread() to read binary data from a file, it makes multiple calls to read() to fetch the requested data. Similarly, when you call fwrite() to write binary data to a file, it makes multiple calls to write().</p><p>In this class, I encourage you to use read() and write() for file IO for their simplicity, plus you will get no performance boost because of disabled IO buffers via setvbuf().</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://hisenz.com/post/opsys-memo/memory-debugging/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/h-logo.svg"><meta itemprop="name" content="Hisen Zhang"><meta itemprop="description" content="海森的博客 - 技术, 料理 & 爵士乐"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="海森的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/post/opsys-memo/memory-debugging/" class="post-title-link" itemprop="url">The Guide to Memory Debugging</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2023-05-02 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-02T00:00:00+08:00">2023-05-02</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-05-11 12:46:19" itemprop="dateModified" datetime="2023-05-11T12:46:19+08:00">2023-05-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Lecture/" itemprop="url" rel="index"><span itemprop="name">Lecture</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus: </span><a title="disqus" href="/post/opsys-memo/memory-debugging/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/opsys-memo/memory-debugging/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>As a C programmer, debugging memory issues can be one of the most frustrating tasks. When your code is dealing with memory, the slightest mistake can cause your program to crash or produce unexpected results. Therefore, it is crucial to be equipped with handy tools and techniques to effectively and elegantly debug memory issues.</p><p>In this memo, I will cover some tips and tricks for troubleshooting 90% of memory issues in C for the CSCI 4210 Operating System, based on my observation as a TA/mentor over semesters.</p><h2 id="Get-Handy-Tools"><a href="#Get-Handy-Tools" class="headerlink" title="Get Handy Tools"></a>Get Handy Tools</h2><p>The first step in debugging memory issues is to have a reliable memory debugger. It sounds funny as I make this the first tip, but I found some past students don’t have a memory debugger installed on their machines by the end of the semester. More people have memory debuggers installed on VM but rarely use them. Save your life by making your tools handy.</p><p>Several memory debuggers are available in the market, including valgrind and drmemory. These tools help you detect and fix memory issues by providing detailed information about the program’s memory usage.</p><h2 id="Print-Print-Print"><a href="#Print-Print-Print" class="headerlink" title="Print. Print. Print"></a>Print. Print. Print</h2><p>If you are unsure where the program encountered segmentation fault, add a bunch of print statements here and there. See where the program halts. Then, print variables referenced around that location to see if they meet your expectation.</p><p>A more elegant way is to use a debugger such as GDB. Despite this class not requiring it, and it’s a steep learning curve initially, I strongly encourage you to pick it up because your precious time and good mood saved are well worth the effort.</p><h2 id="Apply-the-g-flag"><a href="#Apply-the-g-flag" class="headerlink" title="Apply the -g flag"></a>Apply the -g flag</h2><p>To enable debugging information in your code, compile your program with the -g flag. This flag tells the compiler to generate debug information that the debugger can use to provide detailed information about your program’s memory usage. You will see the line number indicating where the error was detected. From there, you can reason along your code to trace where the error was made.</p><h2 id="First-Error-First"><a href="#First-Error-First" class="headerlink" title="First Error First"></a>First Error First</h2><p>Debugging memory issues can be overwhelming, especially when dealing with hundreds of error messages. Therefore, it is important to start with the first error you encounter. This will eliminate cascading failures as much as possible and help you gain confidence and momentum as you move on to more complex issues.</p><h2 id="Invalid-Read-Invalid-Write"><a href="#Invalid-Read-Invalid-Write" class="headerlink" title="Invalid Read, Invalid Write"></a>Invalid Read, Invalid Write</h2><p>One of the most common memory issues is an invalid read or write. This occurs when you attempt to read or write to a memory location you cannot access. This can be caused by several factors, including uninitialized variables, out-of-bounds array access, and invalid pointers.</p><p>Check the address being accessed. Is it REALLY what you thought it should be?</p><p>When debugging an invalid read or write, pay attention to the location and size of the accessed memory. For example:</p><ul><li>”Address is 4 bytes after a block of 4096 bytes alloc’d” may imply an integer being accessed out-of-boundary of a large int array</li><li>“Address is 0 bytes after …” could be something wrong with terminating zero (“\0” or 0x00) of a string</li></ul><h2 id="Leaks-and-Double-Free"><a href="#Leaks-and-Double-Free" class="headerlink" title="Leaks and Double Free"></a>Leaks and Double Free</h2><p>Memory leaks occur when you allocate memory and do not release it properly, causing out-of-memory (OOM) and crashing. Another common issue is double free. This occurs when you attempt to free a block of memory that has already been freed, which can lead to heap corruption and cause your program to crash.</p><p>Both problems can be avoided in the first place by structuring your programs neatly. All homework in this class would be painless if programs were neatly structured, yet it takes intentional practice to build such a gut reaction.</p><p>As we call C the “memory-oriented programming,” drawing your memory chunks on paper and seeing how they interact with functions dramatically helps, similar to objects in OOP. Think about the data life cycle and determine the best time to allocate or free them - and always write malloc and free in pairs.</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><nav class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a></nav><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){const e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;const e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Hisen Zhang</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">NexT.Pisces</a></div></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script>function loadCount(){var d=document,n=d.createElement("script");n.src="https://hisenz.disqus.com/count.js",n.id="dsq-count-scr",(d.head||d.body).appendChild(n)}window.addEventListener("load",loadCount,!1)</script></body></html>