<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/h-favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/h-favicon-16x16.png"><link rel="mask-icon" href="/images/h-logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"hisenz.com",root:"/",scheme:"Pisces",version:"8.0.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!1,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:"disqus",storage:!0,lazyload:!0,nav:null,activeClass:"disqus"},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,i18n:{placeholder:"Searching...",empty:"We didn't find any results for the search: ${query}",hits_time:"${hits} results found in ${time} ms",hits:"${hits} results found"}}</script><meta name="description" content="As a C programmer, debugging memory issues can be one of the most frustrating tasks. When your code is dealing with memory, the slightest mistake can cause your program to crash or produce unexpected"><meta property="og:type" content="article"><meta property="og:title" content="The Guide to Memory Debugging"><meta property="og:url" content="https://hisenz.com/post/opsys-memo/memory-debugging/index.html"><meta property="og:site_name" content="海森的博客"><meta property="og:description" content="As a C programmer, debugging memory issues can be one of the most frustrating tasks. When your code is dealing with memory, the slightest mistake can cause your program to crash or produce unexpected"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2023-05-01T16:00:00.000Z"><meta property="article:modified_time" content="2023-05-11T05:06:27.138Z"><meta property="article:author" content="Hisen Zhang"><meta property="article:tag" content="Spark"><meta property="article:tag" content="Tutorial"><meta property="article:tag" content="OPSYS"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://hisenz.com/post/opsys-memo/memory-debugging/"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>The Guide to Memory Debugging | 海森的博客</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript><link rel="alternate" href="/rss2.xml" title="海森的博客" type="application/rss+xml">
</head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">海森的博客</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Hacking, Cooking & Thinking</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-tech"><a href="/categories/Technology" rel="section"><i class="fa fa-desktop fa-fw"></i>Tech</a></li><li class="menu-item menu-item-food"><a href="/categories/Food" rel="section"><i class="fa fa-utensils fa-fw"></i>Food</a></li><li class="menu-item menu-item-music"><a href="/categories/Music" rel="section"><i class="fa fa-music fa-fw"></i>Music</a></li><li class="menu-item menu-item-spark"><a href="/categories/Spark" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Spark</a></li><li class="menu-item menu-item-lecture"><a href="/categories/Lecture" rel="section"><i class="fa fa-graduation-cap fa-fw"></i>Lecture</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li></ul></nav></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Get-Handy-Tools"><span class="nav-number">1.</span> <span class="nav-text">Get Handy Tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Print-Print-Print"><span class="nav-number">2.</span> <span class="nav-text">Print. Print. Print</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Apply-the-g-flag"><span class="nav-number">3.</span> <span class="nav-text">Apply the -g flag</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#First-Error-First"><span class="nav-number">4.</span> <span class="nav-text">First Error First</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Invalid-Read-Invalid-Write"><span class="nav-number">5.</span> <span class="nav-text">Invalid Read, Invalid Write</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Leaks-and-Double-Free"><span class="nav-number">6.</span> <span class="nav-text">Leaks and Double Free</span></a></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Hisen Zhang" src="/images/h-logo.svg"><p class="site-author-name" itemprop="name">Hisen Zhang</p><div class="site-description" itemprop="description">海森的博客 - 技术, 料理 & 爵士乐</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">64</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">6</span> <span class="site-state-item-name">categories</span></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">46</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/HisenZhang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;HisenZhang" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:hisenzhang01@gmail.com" title="E-Mail → mailto:hisenzhang01@gmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Hisen & Friends</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://maomihz.com/" title="https:&#x2F;&#x2F;maomihz.com" rel="noopener" target="_blank">MaomiHZ</a></li><li class="links-of-blogroll-item"><a href="https://hivechat.org/" title="https:&#x2F;&#x2F;hivechat.org" rel="noopener" target="_blank">Echo's Hive</a></li><li class="links-of-blogroll-item"><a href="https://sites.google.com/view/yuxincai/home" title="https:&#x2F;&#x2F;sites.google.com&#x2F;view&#x2F;yuxincai&#x2F;home" rel="noopener" target="_blank">Yuxin</a></li></ul></div></section></div></aside><div class="sidebar-dimmer"></div></header><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://hisenz.com/post/opsys-memo/memory-debugging/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/h-logo.svg"><meta itemprop="name" content="Hisen Zhang"><meta itemprop="description" content="海森的博客 - 技术, 料理 & 爵士乐"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="海森的博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">The Guide to Memory Debugging</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2023-05-02 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-02T00:00:00+08:00">2023-05-02</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-05-11 13:06:27" itemprop="dateModified" datetime="2023-05-11T13:06:27+08:00">2023-05-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Lecture/" itemprop="url" rel="index"><span itemprop="name">Lecture</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus: </span><a title="disqus" href="/post/opsys-memo/memory-debugging/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/opsys-memo/memory-debugging/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>As a C programmer, debugging memory issues can be one of the most frustrating tasks. When your code is dealing with memory, the slightest mistake can cause your program to crash or produce unexpected results. Therefore, it is crucial to be equipped with handy tools and techniques to effectively and elegantly debug memory issues.</p><p>In this memo, I will cover some tips and tricks for troubleshooting 90% of memory issues in C for the CSCI 4210 Operating System, based on my observation as a TA/mentor over semesters.</p><span id="more"></span><h2 id="Get-Handy-Tools"><a href="#Get-Handy-Tools" class="headerlink" title="Get Handy Tools"></a>Get Handy Tools</h2><p>The first step in debugging memory issues is to have a reliable memory debugger. It sounds funny as I make this the first tip, but I found some past students don’t have a memory debugger installed on their machines by the end of the semester. More people have memory debuggers installed on VM but rarely use them. Save your life by making your tools handy.</p><p>Several memory debuggers are available in the market, including valgrind and drmemory. These tools help you detect and fix memory issues by providing detailed information about the program’s memory usage.</p><h2 id="Print-Print-Print"><a href="#Print-Print-Print" class="headerlink" title="Print. Print. Print"></a>Print. Print. Print</h2><p>If you are unsure where the program encountered segmentation fault, add a bunch of print statements here and there. See where the program halts. Then, print variables referenced around that location to see if they meet your expectation.</p><p>A more elegant way is to use a debugger such as GDB. Despite this class not requiring it, and it’s a steep learning curve initially, I strongly encourage you to pick it up because your precious time and good mood saved are well worth the effort.</p><h2 id="Apply-the-g-flag"><a href="#Apply-the-g-flag" class="headerlink" title="Apply the -g flag"></a>Apply the -g flag</h2><p>To enable debugging information in your code, compile your program with the -g flag. This flag tells the compiler to generate debug information that the debugger can use to provide detailed information about your program’s memory usage. You will see the line number indicating where the error was detected. From there, you can reason along your code to trace where the error was made.</p><h2 id="First-Error-First"><a href="#First-Error-First" class="headerlink" title="First Error First"></a>First Error First</h2><p>Debugging memory issues can be overwhelming, especially when dealing with hundreds of error messages. Therefore, it is important to start with the first error you encounter. This will eliminate cascading failures as much as possible and help you gain confidence and momentum as you move on to more complex issues.</p><h2 id="Invalid-Read-Invalid-Write"><a href="#Invalid-Read-Invalid-Write" class="headerlink" title="Invalid Read, Invalid Write"></a>Invalid Read, Invalid Write</h2><p>One of the most common memory issues is an invalid read or write. This occurs when you attempt to read or write to a memory location you cannot access. This can be caused by several factors, including uninitialized variables, out-of-bounds array access, and invalid pointers.</p><p>Check the address being accessed. Is it REALLY what you thought it should be?</p><p>When debugging an invalid read or write, pay attention to the location and size of the accessed memory. For example:</p><ul><li>”Address is 4 bytes after a block of 4096 bytes alloc’d” may imply an integer being accessed out-of-boundary of a large int array</li><li>“Address is 0 bytes after …” could be something wrong with terminating zero (“\0” or 0x00) of a string</li></ul><h2 id="Leaks-and-Double-Free"><a href="#Leaks-and-Double-Free" class="headerlink" title="Leaks and Double Free"></a>Leaks and Double Free</h2><p>Memory leaks occur when you allocate memory and do not release it properly, causing out-of-memory (OOM) and crashing. Another common issue is double free. This occurs when you attempt to free a block of memory that has already been freed, which can lead to heap corruption and cause your program to crash.</p><p>Both problems can be avoided in the first place by structuring your programs neatly. All homework in this class would be painless if programs were neatly structured, yet it takes intentional practice to build such a gut reaction.</p><p>As we call C the “memory-oriented programming,” drawing your memory chunks on paper and seeing how they interact with functions dramatically helps, similar to objects in OOP. Think about the data life cycle and determine the best time to allocate or free them - and always write malloc and free in pairs.</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"><strong>Post author: </strong>Hisen Zhang</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://hisenz.com/post/opsys-memo/memory-debugging/" title="The Guide to Memory Debugging">https://hisenz.com/post/opsys-memo/memory-debugging/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="post-tags"><a href="/tags/Spark/" rel="tag"># Spark</a> <a href="/tags/Tutorial/" rel="tag"># Tutorial</a> <a href="/tags/OPSYS/" rel="tag"># OPSYS</a></div><div class="post-nav"><div class="post-nav-item"><a href="/post/CHN-ham-freq/" rel="prev" title="中华人民共和国无线电频率划分规定（业余部分摘录）"><i class="fa fa-chevron-left"></i> 中华人民共和国无线电频率划分规定（业余部分摘录）</a></div><div class="post-nav-item"><a href="/post/opsys-memo/unix-c/" rel="next" title="The Philosophy of UNIX and C Programming Language">The Philosophy of UNIX and C Programming Language <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){const e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;const e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Hisen Zhang</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">NexT.Pisces</a></div></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script>function loadCount(){var d=document,n=d.createElement("script");n.src="https://hisenz.disqus.com/count.js",n.id="dsq-count-scr",(d.head||d.body).appendChild(n)}window.addEventListener("load",loadCount,!1)</script><script>var disqus_config=function(){this.page.url="https://hisenz.com/post/opsys-memo/memory-debugging/",this.page.identifier="post/opsys-memo/memory-debugging/",this.page.title="The Guide to Memory Debugging"};NexT.utils.loadComments("#disqus_thread",()=>{if(window.DISQUS)DISQUS.reset({reload:!0,config:disqus_config});else{var e=document,s=e.createElement("script");s.src="https://hisenz.disqus.com/embed.js",s.setAttribute("data-timestamp",""+ +new Date),(e.head||e.body).appendChild(s)}})</script></body></html>